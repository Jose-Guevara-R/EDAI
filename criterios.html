<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paso 7: Criterios de Evaluaci√≥n - SIED</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/tutorial.css">
  <link rel="stylesheet" href="css/components.css">
</head>

<body class="dark-mode">

  <div class="theme-toggle" onclick="document.body.classList.toggle('dark-mode')">
    <span class="theme-toggle-icon">üåì</span>
    <span class="theme-toggle-text">Modo Visual</span>
  </div>

  <div class="tutorial-layout">
    <!-- Panel Izquierdo: Orientaci√≥n T√©cnica -->
    <aside class="panel-tutorial panel-tecnico">
      <h3>üß≠ Br√∫jula T√©cnica</h3>
      <div class="tutorial-content">
        <span class="badge badge-primary" style="margin-bottom: 16px;">Paso 7 de 8</span>

        <h4>Criterios de Evaluaci√≥n</h4>
        <p>Los criterios son el referente espec√≠fico para el juicio de valor sobre el nivel de desarrollo de las
          competencias. Describen las cualidades de aquello que se quiere valorar y que los estudiantes deben demostrar
          en sus producciones o actuaciones.</p>

        <div class="alert alert-info" style="margin-top: 24px;">
          <div class="alert-message">
            <strong>üí° ¬øC√≥mo redactarlos?</strong><br>
            Toma como base el Est√°ndar (Paso 4) y la Situaci√≥n (Paso 5). Deben ser claros, objetivos y comprensibles
            para los estudiantes.
          </div>
        </div>
      </div>
    </aside>

    <!-- Contenido Central: Formulario -->
    <main class="main-content">
      <div class="container">
        <header class="step-header-container">
          <span class="step-number-badge">Paso 7</span>
          <h1 class="step-title">Criterios de Evaluaci√≥n</h1>
          <p class="step-subtitle">Define las cualidades y desempe√±os que observar√°s en las evidencias recogidas.</p>
        </header>

        <div class="card">
          <div class="alert alert-warning" style="margin-bottom: 32px;">
            <div class="alert-title">
              <span>üìã</span>
              Rigor T√©cnico
            </div>
            <div class="alert-message">
              Los criterios permiten valorar el desempe√±o del estudiante en relaci√≥n con el est√°ndar del ciclo.
              Aseg√∫rate de que sean coherentes con el reto planteado.
            </div>
          </div>

          <div class="form-group">
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
              <label for="criterios" style="margin-bottom: 0;">Criterios de evaluaci√≥n seleccionados:</label>
              <button class="btn-secondary" onclick="generarCriteriosIA()"
                style="padding: 4px 12px; font-size: 0.8rem; border-radius: 8px;">
                ‚ú® Sugerir con IA
              </button>
            </div>
            <textarea id="criterios" rows="8"
              placeholder="Ejemplo: Identifica informaci√≥n en el texto, interpreta el prop√≥sito del autor y argumenta su posici√≥n con coherencia..."></textarea>
          </div>

          <button class="btn-primary" onclick="irAProcesarInstrumentoDesdeCriterios()">
            üíæ Guardar y Generar Instrumento Final
          </button>
        </div>
      </div>
    </main>

    <!-- Panel Derecho: Ejemplo Pr√°ctico -->
    <aside class="panel-tutorial panel-real">
      <div class="ia-badge">‚ú® Voz de la Experiencia</div>
      <h3>üçé Ejemplo Real</h3>
      <div class="tutorial-content">
        <span class="badge badge-warning" style="margin-bottom: 16px;">Caso: Matem√°tica</span>

        <p><strong>Competencia:</strong> Resuelve problemas de cantidad.</p>
        <p><strong>Criterio:</strong> "Utiliza diversas estrategias para calcular el presupuesto familiar y justifica su
          elecci√≥n bas√°ndose en el ahorro mensual."</p>

        <div class="alert alert-info" style="margin-top: 24px;">
          <div class="alert-title">üéØ Meta del Criterio</div>
          <div class="alert-message">
            El criterio no solo dice "calcula bien", sino que pide "justificar". Ah√≠ es donde observamos la profundidad
            de la competencia.
          </div>
        </div>
      </div>
    </aside>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="js/components.js"></script>
  <script src="js/app.js"></script>
  <script>
    window.onload = () => {
      if (typeof updateSteps === 'function') updateSteps(7, 8);
      // Cargar hallazgos previos si existen
      const ev = obtenerEvaluacion();
      if (ev && ev.criterios) {
        document.getElementById("criterios").value = ev.criterios;
      }
      if (typeof cargarTutorial === 'function') cargarTutorial();
    };

    async function irAProcesarInstrumentoDesdeCriterios() {
      const crit = document.getElementById("criterios").value;
      if (!crit.trim()) {
        alert("Por favor, ingresa los criterios de evaluaci√≥n.");
        return;
      }

      const ev = obtenerEvaluacion();
      ev.criterios = crit;
      guardarEvaluacion(ev);

      // Usamos el nuevo sistema de IA para la r√∫brica (as√≠ncrono)
      await generarInstrumentoDiagnostico();
      window.location.href = 'instrumento.html';
    }
  </script>
</body>

</html>